<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta tags -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- title -->
    <title>Recipes - Visit Capljina</title>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/logo/favicon.png" />

    <!-- css -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/all-fontawesome.min.css" />
    <link rel="stylesheet" href="/assets/css/animate.min.css" />
    <link rel="stylesheet" href="/assets/css/magnific-popup.min.css" />
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
  </head>

  <body>
    <!-- preloader -->
    <div class="preloader">
      <div class="loader"></div>
    </div>
    <!-- preloader end -->

    <!-- header area -->
    <header class="header">
      <div class="main-navigation">
        <nav class="navbar navbar-expand-lg">
          <div class="container">
            <a class="navbar-brand" href="/">
              <img src="/assets/img/logo/logo.png" alt="logo" />
            </a>
            <div class="mobile-menu-right">
              <a href="#" class="mobile-search-btn search-box-outer"
                ><i class="far fa-search"></i
              ></a>
              <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#main_nav"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class="navbar-toggler-icon"
                  ><i class="far fa-stream"></i
                ></span>
              </button>
            </div>
            <div class="collapse navbar-collapse" id="main_nav">
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle active"
                    href="#"
                    data-bs-toggle="dropdown"
                    >Početna</a
                  >
                  <ul class="dropdown-menu fade-up">
                    <li>
                      <a class="dropdown-item" href="/"
                        >Home Page 01</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/index-2"
                        >Home Page 02</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/index-3"
                        >Home Page 03</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/about">O nama</a>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    data-bs-toggle="dropdown"
                  >
                    Pages
                  </a>
                  <ul class="dropdown-menu fade-up">
                    <li>
                      <a class="dropdown-item" href="/facility">Facility</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/about">About Us</a>
                    </li>
                    <li><a class="dropdown-item" href="/team">Team</a></li>
                    <li>
                      <a class="dropdown-item" href="/pricing"
                        >Pricing Plan</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/gallery">Gallery</a>
                    </li>
                    <li><a class="dropdown-item" href="/faq">Faq</a></li>
                    <li>
                      <a class="dropdown-item" href="/login">Login</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/register">Register</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/forgot-password"
                        >Forgot Password</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/404">404 Error</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/coming-soon"
                        >Coming Soon</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/terms"
                        >Terms Of Service</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/privacy"
                        >Privacy Policy</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    data-bs-toggle="dropdown"
                    >Novosti</a
                  >
                  <ul class="dropdown-menu fade-up">
                    <li><a class="dropdown-item" href="/blog">Blog</a></li>
                    <li>
                      <a class="dropdown-item" href="/blog-single"
                        >Blog Single</a
                      >
                    </li>
                  </ul>
                </li>

                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    data-bs-toggle="dropdown"
                    >Dinamičke</a
                  >
                  <ul class="dropdown-menu fade-up">
                    <li>
                      <a class="dropdown-item" href="/recipes">Recepti</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="news.html">Novosti</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="restaurants.html">
                        Restorani
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="locations.html">
                        Lokacije
                      </a>
                    </li>
                  </ul>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="/contact">Kontakt</a>
                </li>
              </ul>
              <div class="header-nav-right">
                <div class="header-nav-search">
                  <a href="#" class="search-box-outer"
                    ><i class="far fa-search"></i
                  ></a>
                </div>
                <div class="header-btn">
                  <a href="#" class="theme-btn"
                    >Get Quote<i class="far fa-arrow-right"></i
                  ></a>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- header area end -->

    <!-- popup search -->
    <div class="search-popup">
      <button class="close-search"><span class="far fa-times"></span></button>
      <form action="#">
        <div class="form-group">
          <input
            type="search"
            name="search-field"
            placeholder="Search Here..."
            required
          />
          <button type="submit"><i class="far fa-search"></i></button>
        </div>
      </form>
    </div>
    <!-- popup search end -->

    <main class="main">
      <!-- breadcrumb -->
      <div
        class="site-breadcrumb"
        style="background: url(/assets/img/breadcrumb/breadcrumb.jpg)"
      >
        <div class="container">
          <h2 class="breadcrumb-title">Naši recepti</h2>
          <ul class="breadcrumb-menu">
            <li><a href="/">Početna</a></li>
            <li class="active">Recepti</li>
          </ul>
        </div>
      </div>
      <!-- breadcrumb end -->

      <!-- recipes-area -->
      <div class="blog-area py-120">
        <div class="container">
          <div class="row" id="recipes-container">
            <!-- Recipes will be loaded here dynamically -->
            <div class="col-12 text-center" id="loading">
              <p>Dohvaćam recepte...</p>
            </div>
          </div>

          <!-- pagination -->
          <div class="pagination-area">
            <div aria-label="Page navigation example">
              <ul class="pagination">
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true"
                      ><i class="far fa-angle-double-left"></i
                    ></span>
                  </a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true"
                      ><i class="far fa-angle-double-right"></i
                    ></span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- recipes-area end -->
    </main>

    <!-- footer area -->
    <footer class="footer-area">
      <div class="footer-shape">
        <img class="footer-shape-1" src="/assets/img/shape/01.png" alt="" />
      </div>
      <div class="footer-widget">
        <div class="container">
          <div class="row footer-widget-wrapper pt-100 pb-70">
            <div class="col-md-6 col-lg-4">
              <div class="footer-widget-box about-us">
                <a href="/" class="footer-logo">
                  <img src="/assets/img/logo/logo.png" alt="" />
                </a>
                <p class="mb-20">
                  We are many variations of passages available but the majority
                  have suffered alteration in some form by injected humour words
                  which don't look even slightly believable.
                </p>
                <ul class="footer-social">
                  <li>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="footer-widget-box">
                <h4 class="footer-widget-title">Contact Us</h4>
                <ul class="footer-contact">
                  <li>
                    <i class="far fa-map-marker-alt"></i>25/B Milford Road, New
                    York
                  </li>
                  <li>
                    <a href="tel:+21236547898"
                      ><i class="far fa-phone"></i>+2 123 654 7898</a
                    >
                  </li>
                  <li>
                    <a href="mailto:info@example.com"
                      ><i class="far fa-envelope"></i>info@example.com</a
                    >
                  </li>
                  <li><i class="far fa-clock"></i>Sun - Fri (08AM - 10PM)</li>
                </ul>
              </div>
            </div>
            <div class="col-md-6 col-lg-2">
              <div class="footer-widget-box list">
                <h4 class="footer-widget-title">Quick Links</h4>
                <ul class="footer-list">
                  <li>
                    <a href="#"><i class="fas fa-caret-right"></i> About Us</a>
                  </li>
                  <li>
                    <a href="#"><i class="fas fa-caret-right"></i> FAQ's</a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fas fa-caret-right"></i> Terms Of Service</a
                    >
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fas fa-caret-right"></i> Privacy policy</a
                    >
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fas fa-caret-right"></i> Our Services</a
                    >
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="footer-widget-box list">
                <h4 class="footer-widget-title">Newsletter</h4>
                <div class="footer-newsletter">
                  <p>Subscribe Our Newsletter To Get Latest Update And News</p>
                  <div class="subscribe-form">
                    <form action="#">
                      <input
                        type="email"
                        class="form-control"
                        placeholder="Your Email"
                      />
                      <button class="theme-btn" type="submit">
                        <span class="far fa-envelope"></span> Subscribe Now
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copyright">
        <div class="container">
          <div class="row">
            <div class="col-lg-6 align-self-center">
              <p class="copyright-text">
                &copy; Copyright <span id="date"></span>
                <a href="#"> GOLFOX </a> All Rights Reserved.
              </p>
            </div>
            <div class="col-lg-6 align-self-center">
              <ul class="footer-menu">
                <li><a href="#">Support</a></li>
                <li><a href="#">Terms Of Services</a></li>
                <li><a href="#">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- footer area end -->

    <!-- scroll-top -->
    <a href="#" id="scroll-top"><i class="far fa-angle-double-up"></i></a>
    <!-- scroll-top end -->

    <!-- js -->
    <script src="/assets/js/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/modernizr.min.js"></script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/imagesloaded.pkgd.min.js"></script>
    <script src="/assets/js/jquery.magnific-popup.min.js"></script>
    <script src="/assets/js/isotope.pkgd.min.js"></script>
    <script src="/assets/js/jquery.appear.min.js"></script>
    <script src="/assets/js/jquery.easing.min.js"></script>
    <script src="/assets/js/owl.carousel.min.js"></script>
    <script src="/assets/js/counter-up.js"></script>
    <script src="/assets/js/masonry.pkgd.min.js"></script>
    <script src="/assets/js/wow.min.js"></script>
    <script src="/assets/js/main.js"></script>

    <script type="module">
      // Pagination state
      let currentPage = 1;
      const recipesPerPage = 6; // Number of recipes per page
      let totalRecipes = 0;
      let totalPages = 0;

      // Function to build API URL with pagination
      function getRecipeUrl(page = 1, limit = recipesPerPage) {
        const skip = (page - 1) * limit;
        return `https://cdn.contentful.com/spaces/${
          import.meta.env.VITE_CONTENTFUL_API_KEY
        }/environments/master/entries?content_type=recipePage&include=2&limit=${limit}&skip=${skip}`;
      }

      // Function to find asset by ID in the includes
      function findAsset(assetId, includes) {
        if (!includes || !includes.Asset) return null;
        return includes.Asset.find((asset) => asset.sys.id === assetId);
      }

      // Function to render pagination
      function renderPagination() {
        const paginationContainer = document.querySelector(".pagination");
        if (!paginationContainer) return;

        let paginationHTML = "";

        // Previous button
        const prevDisabled = currentPage === 1 ? "disabled" : "";
        paginationHTML += `
          <li class="page-item ${prevDisabled}">
            <a class="page-link" href="#" aria-label="Previous" data-page="${
              currentPage - 1
            }">
              <span aria-hidden="true"><i class="far fa-angle-double-left"></i></span>
            </a>
          </li>
        `;

        // Page numbers
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);

        for (let i = startPage; i <= endPage; i++) {
          const activeClass = i === currentPage ? "active" : "";
          paginationHTML += `
            <li class="page-item ${activeClass}">
              <a class="page-link" href="#" data-page="${i}">${i}</a>
            </li>
          `;
        }

        // Next button
        const nextDisabled = currentPage === totalPages ? "disabled" : "";
        paginationHTML += `
          <li class="page-item ${nextDisabled}">
            <a class="page-link" href="#" aria-label="Next" data-page="${
              currentPage + 1
            }">
              <span aria-hidden="true"><i class="far fa-angle-double-right"></i></span>
            </a>
          </li>
        `;

        paginationContainer.innerHTML = paginationHTML;

        // Add click handlers
        paginationContainer.querySelectorAll(".page-link").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            const page = parseInt(e.target.closest("a").dataset.page);
            if (
              page &&
              page !== currentPage &&
              page >= 1 &&
              page <= totalPages
            ) {
              loadRecipes(page); // Pass true to enable scrolling for pagination clicks
            }
          });
        });
      }

      // Function to render recipe cards
      function renderRecipes(recipes, includes) {
        const container = document.getElementById("recipes-container");
        const loadingElement = document.getElementById("loading");

        // Remove loading message
        if (loadingElement) {
          loadingElement.remove();
        }

        if (!recipes || recipes.length === 0) {
          container.innerHTML =
            '<div class="col-12 text-center"><p>Nema pronađenih recepata.</p></div>';
          return;
        }

        let recipesHTML = "";

        recipes.forEach((recipe) => {
          const fields = recipe.fields;
          const title = fields.title || "Recipe Title";
          const shortDescription =
            fields.shortDescription ||
            "Delicious recipe waiting for you to try!";
          const cookingTime = fields.cookingTime || "30 min";
          const difficulty = fields.difficulty || "Medium";

          // Get thumbnail image URL
          let imageUrl = "/assets/img/blog/01.jpg"; // default image

          // Check if thumbnail exists and get the asset
          if (
            fields.thumbnail &&
            fields.thumbnail.sys &&
            fields.thumbnail.sys.id
          ) {
            const thumbnailAsset = findAsset(fields.thumbnail.sys.id, includes);
            if (
              thumbnailAsset &&
              thumbnailAsset.fields &&
              thumbnailAsset.fields.file
            ) {
              imageUrl =
                "https:" +
                thumbnailAsset.fields.file.url +
                "?w=600&h=400&fit=fill";
            }
          }

          recipesHTML += `
            <div class="col-md-6 col-lg-4">
              <div class="blog-item">
                <div class="blog-item-img">
                  <img src="${imageUrl}" alt="${title}" />
                </div>
                <div class="blog-item-info">
                  <div class="blog-item-meta">
                    <ul>
                      <li>
                        <a href="#"><i class="far fa-clock"></i> ${cookingTime}</a>
                      </li>
                      <li>
                        <a href="#"><i class="far fa-star"></i> ${difficulty}</a>
                      </li>
                    </ul>
                  </div>
                  <h4 class="blog-title">
                    <a href="#">${title}</a>
                  </h4>
                  <p class="recipe-short-description">${shortDescription.substring(
                    0,
                    100
                  )}${shortDescription.length > 100 ? "..." : ""}</p>
                  <a class="blog-btn" href="#" data-recipe-id="${
                    recipe.sys.id
                  }">
                    View Recipe<i class="far fa-arrow-right"></i>
                  </a>
                </div>
              </div>
            </div>
          `;
        });

        container.innerHTML = recipesHTML;

        // Render pagination after recipes are loaded
        renderPagination();
      }

      // Function to show loading state
      function showLoading() {
        const container = document.getElementById("recipes-container");
        container.innerHTML =
          '<div class="col-12 text-center" id="loading"><p>Dohvaćam recepte...</p></div>';
      }

      // Function to load recipes for a specific page
      function loadRecipes(page = 1, shouldScroll = false) {
        currentPage = page;
        showLoading();

        fetch(getRecipeUrl(page), {
          headers: {
            Authorization: `Bearer ${
              import.meta.env.VITE_CONTENTFUL_BEARER_TOKEN
            }`,
          },
        })
          .then((res) => {
            if (!res.ok) {
              throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
          })
          .then((data) => {
            // Update pagination info
            totalRecipes = data.total;
            totalPages = Math.ceil(totalRecipes / recipesPerPage);

            renderRecipes(data.items, data.includes);

            // Only scroll when changing pages, not on initial load
            if (shouldScroll) {
              document.getElementById("recipes-container").scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          })
          .catch(handleError);
      }

      // Function to handle errors
      function handleError(error) {
        console.error("Error fetching recipes:", error);
        const container = document.getElementById("recipes-container");
        const loadingElement = document.getElementById("loading");

        if (loadingElement) {
          loadingElement.remove();
        }

        container.innerHTML = `
          <div class="col-12 text-center">
            <p>Žao mi je, trenutno ne mogu učitati recepte. Molimo pokušajte kasnije.</p>
          </div>
        `;
      }

      // Initialize: Load first page of recipes
      loadRecipes(1);
    </script>
  </body>
</html>
